define(["lodash","coreUtilsLib"],(function(n,t){return function(n){var t={};function e(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=n,e.c=t,e.d=function(n,t,r){e.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:r})},e.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,t){if(1&t&&(n=e(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var o in n)e.d(r,o,function(t){return n[t]}.bind(null,o));return r},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="",e(e.s=8)}([function(t,e){t.exports=n},function(n,t,e){"use strict";e.r(t),e.d(t,"isMergeVirtualGroup",(function(){return a})),e.d(t,"isRescaleVirtualGroup",(function(){return s})),e.d(t,"isVirtualGroup",(function(){return f})),e.d(t,"isDesktopOnlyComponent",(function(){return l})),e.d(t,"isTextComponent",(function(){return d})),e.d(t,"isVerticalText",(function(){return p})),e.d(t,"isGraphicComponent",(function(){return m})),e.d(t,"isGroupComponent",(function(){return v})),e.d(t,"isAppWidgetComponent",(function(){return y})),e.d(t,"isColumnsContainerComponent",(function(){return g})),e.d(t,"isColumnComponent",(function(){return h})),e.d(t,"isClassicSectionComponent",(function(){return T})),e.d(t,"isImageComponent",(function(){return E})),e.d(t,"isMasterPage",(function(){return O})),e.d(t,"isMasterPageChild",(function(){return _})),e.d(t,"isDockingAllowed",(function(){return b})),e.d(t,"isFixedPositionAllowed",(function(){return C})),e.d(t,"isFixedPositionElement",(function(){return D})),e.d(t,"shouldConvertFixedPositionToAbsolute",(function(){return x})),e.d(t,"isExistsBeforeMerge",(function(){return M})),e.d(t,"shouldStretchToScreenWidth",(function(){return I})),e.d(t,"extractComponentsFromStructureByType",(function(){return P})),e.d(t,"isScreenWidthComponent",(function(){return R})),e.d(t,"translateComps",(function(){return S})),e.d(t,"reparentComponent",(function(){return w})),e.d(t,"addComponentsTo",(function(){return N})),e.d(t,"removeChildrenFrom",(function(){return A})),e.d(t,"removeGroup",(function(){return G})),e.d(t,"containsComponent",(function(){return B})),e.d(t,"getHeightAccordingToChildren",(function(){return L})),e.d(t,"ensureContainerTightlyWrapsChildren",(function(){return z})),e.d(t,"isSiteSegmentOrPage",(function(){return j})),e.d(t,"isPageComponent",(function(){return U})),e.d(t,"isMobileOnlyElement",(function(){return F})),e.d(t,"isModifiedComponent",(function(){return H})),e.d(t,"isNewlyComponent",(function(){return k})),e.d(t,"isDirectParentOfMOC",(function(){return V})),e.d(t,"componentListToMap",(function(){return W})),e.d(t,"isImplicityModified",(function(){return Y})),e.d(t,"shouldKeepOnMobile",(function(){return X})),e.d(t,"isContainerComponent",(function(){return K})),e.d(t,"isSiteSegment",(function(){return Q})),e.d(t,"isAllowedToBeInMasterPage",(function(){return Z})),e.d(t,"extractMobilePage",(function(){return q})),e.d(t,"getComponentByIdFromStructure",(function(){return J})),e.d(t,"unifyGroups",(function(){return $})),e.d(t,"getComponentsByIds",(function(){return nn})),e.d(t,"getParent",(function(){return tn})),e.d(t,"getParentIdFromMobileHints",(function(){return en})),e.d(t,"setParentIdToMobileHints",(function(){return rn})),e.d(t,"getSnugLayout",(function(){return on})),e.d(t,"getTinyMenuDefaultPosition",(function(){return un})),e.d(t,"getChildren",(function(){return cn})),e.d(t,"getRootChild",(function(){return an})),e.d(t,"getRangesOverlap",(function(){return sn})),e.d(t,"getYOverlap",(function(){return fn})),e.d(t,"getXOverlap",(function(){return ln})),e.d(t,"hasGreaterArea",(function(){return pn})),e.d(t,"haveSufficientOverlap",(function(){return mn})),e.d(t,"isEmptyContainer",(function(){return vn})),e.d(t,"shouldReparentCompToChildOfContainer",(function(){return yn})),e.d(t,"getFlattenListOfComponents",(function(){return gn})),e.d(t,"getAllCompsInStructure",(function(){return hn})),e.d(t,"isSemiTransparentContainer",(function(){return Tn}));var r=e(0),o=e(2),i=e(4),u=e(5),c=function(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=function(n){return r.get(n,"componentType")===o.a.VIRTUAL_GROUP_TYPES.MERGE},s=function(n){return r.get(n,"componentType")===o.a.VIRTUAL_GROUP_TYPES.RESCALE},f=function(n){return s(n)||a(n)};function l(n){return r.get(n,["conversionData","desktopOnly"],!1)}function d(n){return"text"===r.get(n,["conversionData","category"])}function p(n){return r.get(n,["conversionData","isVerticalText"],!1)}function m(n){return"graphic"===r.get(n,["conversionData","category"])||E(n)}function v(n){return n&&"wysiwyg.viewer.components.Group"===n.componentType}function y(n){return n&&"platform.components.AppWidget"===n.componentType}function g(n){return"columns"===r.get(n,["conversionData","category"])}var h=function(n){return"column"===r.get(n,["conversionData","category"])},T=function(n){return"section"===r.get(n,["conversionData","category"])||"wysiwyg.viewer.components.ClassicSection"===r.get(n,["componentType"])};function E(n){return"photo"===r.get(n,["conversionData","category"])}function O(n){return"masterPage"===r.get(n,"id")}function _(n){return r.includes(["SITE_FOOTER","SITE_HEADER","SITE_PAGES","PAGES_CONTAINER"],n.id)}function b(n){return r.get(n,["conversionData","isDockingAllowed"])}function C(n){return r.get(n,["conversionData","isFixedPositionAllowed"])}function D(n){return r.get(n,["layout","fixedPosition"],!1)}function x(n){return r.get(n,["conversionData","convertFixedPositionToAbsolute"],!1)}function M(n){return!!n.conversionData&&n.conversionData.existsBeforeMerge}function I(n){var t=function(n){return r.get(n.conversionData,"isScreenWidth",!1)||r.get(n.conversionData,"stretchHorizontally",!1)||r.some(n.components,t)};return j(n)||t(n)}function P(n,t){var e=cn(n),o=r.remove(e,(function(n){var e=y(n)&&an(n);return r.includes(t,n.componentType)||e&&r.includes(t,e.componentType)}));return r.concat(o,r.flatMap(e,(function(n){return P(n,t)})))}function R(n){return r.get(n.conversionData,"isScreenWidth",!1)||r.some(n.components,R)}function S(n,t,e){void 0===t&&(t=0),void 0===e&&(e=0),r.forEach(n,(function(n){n.layout.x+=t,n.layout.y+=e}))}function w(n,t,e){N(n,[t],e),S([t],-n.layout.x,-n.layout.y)}function N(n,t,e){var r=cn(n);t.length&&r&&(e=void 0!==e?e:r.length,r.splice.apply(r,[e,0].concat(t)))}function A(n,t){var e=cn(n);r.remove(e,(function(n){return r.includes(t,n)}))}function G(n,t){if(v(n)){var e=r.findIndex(t.components,{id:n.id});r.forEach(n.components.reverse(),(function(r){N(t,[r],e),S([r],n.layout.x,n.layout.y)})),r.remove(t.components,n)}}function B(n,t){return r.some(cn(n),(function(n){return t(n)||n&&B(n,t)}))}function L(n,t,e){if(!H(n)&&!O(n)&&t&&(e||!r.isEmpty(t))){var i=r(t).reject(["conversionData.isInvisible",!0]).reduce((function(n,t){return r.max([n,t.layout.y+t.layout.height,0])}),0);return r.get(n,["conversionData","hasTightYMargin"])||r.get(n,["conversionData","hasTightBottomMargin"])?i:i+(I(n)?o.a.SECTION_MOBILE_MARGIN_Y:o.a.COMPONENT_MOBILE_MARGIN_Y+r.get(n.conversionData,"borderWidth",0))}}function z(n,t,e,o){void 0===o&&(o=0);var i=L(n,t,e);if(r.isNumber(i)){var u=r.get(n,["conversionData","minHeight"],o);n.layout.height=Math.max(u,i)}}function j(n){return U(n)||Q(n)}function U(n){return"Page"===n.type}function F(n){return r.get(n,["conversionData","mobileHints","mobileOnlyElement"])}function H(n){return r.get(n,["conversionData","mobileHints","modifiedByUser"],!1)}var k=function(n){return r.get(n,["conversionData","existsOnMobileBeforeMerge",!1])},V=function(n){return r.get(n,["conversionData","isDirectParentOfMobileOnly"],!1)},W=function(n){return n.reduce((function(n,t){return n.set(t.id,t)&&n}),new Map)},Y=function(n,t){return t.has(n.id)},X=function(n,t){return H(n)||Y(n,t)||Object(u.a)(n)||V(n)};function K(n){return"Container"===n.type}function Q(n){return r.has(n.conversionData,"siteSegmentRole")}function Z(n){return Q(n)||r.has(n.conversionData,"isAllowedToBeChildOfMasterPage")}function q(n){var t=i.objectUtils.cloneDeep(n),e=r.has(t,"components")?"components":"children";return r.set(t,e,n.mobileComponents||[])}function J(n,t){if(t.id===n)return t;var e=null;return r.find(cn(t),(function(t){return e=J(n,t)})),e}function $(n,t){if(n.length>t)n.length=0;else for(var e=function(t){var e=r.findLastIndex(n,(function(e,o){return o<t&&(i=n[t],u=e,r.size(r.intersection(i,u))>0);var i,u}));-1!==e&&(n[e]=n[e].concat(r.difference(n[t],n[e])),n.splice(t,1))},o=n.length-1;o>=0;o--)e(o)}function nn(n,t){var e=cn(n);return r.map(t,(function(n){return r.find(e,{id:n})||null}))}function tn(n,t){var e=cn(t);if(r.find(e,{id:n}))return t;var o=null;return r.find(e,(function(t){return o=tn(n,t)})),o}var en=function(n){var t,e;return null===(e=null===(t=n.conversionData)||void 0===t?void 0:t.mobileHints)||void 0===e?void 0:e.parent},rn=function(n,t){return r.set(n,["conversionData","mobileHints","parent"],t)};function on(n){if(n&&0!==n.length){var t=r.min(r.map(n,"layout.x")),e=r.min(r.map(n,"layout.y"));return{x:t,y:e,width:r.max(r.map(n,(function(n){return n.layout.x+n.layout.width})))-t,height:r.max(r.map(n,(function(n){return n.layout.y+n.layout.height})))-e,rotationInDegrees:0}}}function un(){return{x:o.a.MOBILE_WIDTH-(o.a.TINY_MENU_SIZE+o.a.SITE_SEGMENT_PADDING_X),y:o.a.SECTION_MOBILE_MARGIN_Y,rotationInDegrees:0}}var cn=function(n){return n.components||n.children},an=function(n){return r.get(n,["components",0])||r.get(n,["children",0])};function sn(n,t){void 0===n&&(n=[]),void 0===t&&(t=[]);var e=function(n,t){return Math.min(n[1],t[1])-t[0]};return n[0]<=t[0]?e(n,t):e(t,n)}function fn(n,t){var e=function(n){return[n.layout.y,n.layout.height+n.layout.y]};return sn(e(n),e(t))}function ln(n,t){if(R(n))return t.layout.width;if(R(t))return n.layout.width;var e=function(n){return[n.layout.x,n.layout.width+n.layout.x]};return sn(e(n),e(t))}var dn=function(n){return n.layout.width*n.layout.height};function pn(n,t){return R(n)?n.layout.height>=t.layout.height||dn(n)>dn(t):!R(t)&&dn(n)>dn(t)}function mn(n,t,e){var r=ln(n,t),o=fn(n,t);if(r<=0||o<=0)return!1;var i=r*o,u=Math.min(dn(n),dn(t));return i>0&&i/u>=e}function vn(n){return!!K(n)&&("columns"===n.conversionData.category?1===r.size(n.components)&&r.isEmpty(n.components[0].components):r.isEmpty(n.components))}function yn(n,t){return g(t)&&r.get(n,["conversionData","isInvisible"],!1)}var gn=function(n,t){var e,o;void 0===t&&(t=!1);var i=[[n]];try{for(var u=c(i),a=u.next();!a.done;a=u.next()){var s=a.value;r.forEach(s,(function(n){var e=t?r.get(n,"mobileComponents"):cn(n);r.isEmpty(e)||i.push(e)}))}}catch(n){e={error:n}}finally{try{a&&!a.done&&(o=u.return)&&o.call(u)}finally{if(e)throw e.error}}return r.flatten(i)};function hn(n,t,e){void 0===t&&(t=!1);var o=gn(n,t);return r(o).remove(e).keyBy("id").value()}var Tn=function(n){return r.get(n,["conversionData","isSemiTransparentContainer"],!1)}},function(n,t,e){"use strict";e.d(t,"a",(function(){return r}));var r={MOBILE_WIDTH:320,MARGIN_BETWEEN_TEXT_AND_NON_TEXT:20,COMPONENT_MOBILE_MARGIN_X:10,COMPONENT_MOBILE_MARGIN_Y:10,SECTION_MOBILE_MARGIN_Y:20,SITE_SEGMENT_PADDING_X:20,TINY_MENU_SIZE:50,TEXT_MAX_LENGTH_FOR_RESCALING:25,MIN_WIDTH_FOR_ENLARGE:140,DEFAULT_TEXT_HEIGHT:10,VIRTUAL_GROUP_TYPES:{RESCALE:"RESCALE_VIRTUAL_GROUP",MERGE:"MERGE_VIRTUAL_GROUP"}}},function(n,t,e){"use strict";e.d(t,"e",(function(){return i})),e.d(t,"c",(function(){return u})),e.d(t,"b",(function(){return c})),e.d(t,"a",(function(){return s})),e.d(t,"d",(function(){return l})),e.d(t,"g",(function(){return d})),e.d(t,"h",(function(){return p})),e.d(t,"f",(function(){return m}));var r=e(0),o=e(1),i=function(n){return 0===n?0:n/Math.abs(n)},u=function(n,t){return"x"===t?n.layout.width:n.layout.height},c=function(n,t){return n.layout[t]+u(n,t)};function a(n,t,e,o){void 0===o&&(o=.1);var i=r.get(n,e),u=r.get(t,e);return Math.abs(i-u)<=o*r.min([i,u])}function s(n,t,e){return n===t||r.size(n)===r.size(t)&&!f(n,e)&&!f(t,e)&&r.every(n,(function(n,o){var i=t[o];return n.componentType===i.componentType&&function(n,t,e,o){void 0===o&&(o=.1);var i=r.get(n,["layout",e]),c=r.get(t,["layout",e]);return Math.abs(i-c)<=o*r.min([u(n,e),u(t,e)])}(n,i,e)&&("text"===n.conversionData.category?a(n,i,["conversionData","averageNormalizedFontSize"]):a(n,i,["layout","height"])&&a(n,i,["layout","width"]))}))}function f(n,t){var e=r.findIndex(n,(function(e,o){if(0===o)return!1;var i=c(n[o-1],t),a=e.layout[t]-i;return a<0||a>r.min([u(n[o-1],t),u(e,t)])}));return-1!==e&&e!==n.length-1}function l(n){var t=o.getChildren(n);return r.map(n.conversionData.componentsOrder,(function(n){return r.find(t,{id:n})}))}var d=function(n){return o.isRescaleVirtualGroup(n)&&"reorder"!==n.conversionData.rescaleMethod||n.conversionData.structuralContainer};function p(n,t){var e=r.map(o.getChildren(n),"id");return r.sortBy(t,(function(n){return e.indexOf(n.id)}))}function m(n){var t=r.pick(n.conversionData.mobileHints,["recommendedWidth","recommendedHeight","recommendedScale","recommendedOrder"]);return!r.isEmpty(t)}},function(n,e){n.exports=t},function(n,t,e){"use strict";e.d(t,"c",(function(){return u})),e.d(t,"b",(function(){return c})),e.d(t,"a",(function(){return a}));var r=e(0),o=["TINY_MENU","BACK_TO_TOP_BUTTON","QUICK_ACTION_BAR","QUICK_ACTION_BAR_ITEM","MENU_AS_CONTAINER_TOGGLE","MENU_AS_CONTAINER_EXPANDABLE_MENU","MENU_TOGGLE"],i=["wysiwyg.viewer.components.mobile.TinyMenu","wysiwyg.viewer.components.BackToTopButton","wysiwyg.common.components.backtotopbutton.viewer.BackToTopButton","wysiwyg.viewer.components.QuickActionBar","wysiwyg.viewer.components.QuickActionBarItem","wysiwyg.viewer.components.MenuToggle","wysiwyg.viewer.components.ExpandableMenu"],u=function(n){return Object(r.includes)(o,n)},c=function(n){return Object(r.includes)(i,Object(r.get)(n,"componentType"))},a=function(n){return c(n)||(t=n,Object(r.get)(t,["conversionData","mobileOnly"]));var t}},function(n,t,e){"use strict";e.d(t,"a",(function(){return T})),e.d(t,"b",(function(){return E})),e.d(t,"c",(function(){return P}));var r=e(0),o=e(3),i=e(4),u=function(n,t){var e="function"==typeof Symbol&&n[Symbol.iterator];if(!e)return n;var r,o,i=e.call(n),u=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)u.push(r.value)}catch(n){o={error:n}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return u},c=function(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(u(arguments[t]));return n},a="start",s="end",f=1,l=1.25;function d(n,t){return r.transform(n,(function(n,e,r){var o=t(r);return n[o]=n[o]||{comps:[],distanceToPreviousFragment:e.distanceToPreviousFragment},n[o].comps=c(n[o].comps,e.comps),n}),[])}var p={singleCompRow:function(n,t,e){if("x"===e)return null;var i=r.findIndex(n,(function(n){return 1===r.size(n.comps)}));if(-1===i)return null;var u=d(n,(function(n){return Object(o.e)(n-i)+Object(o.e)(i)}));return{type:"singleCompRow",fragments:u,fragmentsEvents:C(t,u)}},verticalDivider:function(n,t,e){if(r.size(n)<3||r.every(n,(function(n){return 1===r.size(n.comps)}))||"y"===e)return null;var i=function(n,t){var e=r(t.y).partition({eventType:a}).map((function(n){return r.map(n,"coordinate")})).value(),i=r.max(e[0]),u=r.min(e[1]);return r.findIndex(n,(function(n){var t=n.comps[0];return 1===n.comps.length&&t.conversionData.keepIfVerticalDivider&&t.layout.y<=u&&Object(o.b)(t,"y")>=i}))}(n,t);if(-1===i)return null;r.set(n[i].comps[0],["conversionData","isVerticalDivider"],!0);var u=d(n,(function(n){return Object(o.e)(n-i)+Object(o.e)(i)}));return{type:"verticalDivider",fragments:u,fragmentsEvents:C(t,u)}},mirrorPattern:function(n,t,e){if(r.size(n)<2)return null;var i=C(t,n),u=v(e),c=r.map(i,(function(n){return m(n[u])})),a=r.every(c,(function(n){return Object(o.a)(n,c[0],u)}));return a&&a?g(r.flatten(c),t,{type:"mirrorPattern"}):null},chessPattern:function(n,t,e){if("y"!==e||r.size(n)<2||!r.every(n,(function(n){return 2===r.size(n.comps)})))return null;var o=C(t,n),i=r.map(o,(function(n){return m(n.x)})),u=r.flatMap(i,(function(n,t){return y(t)?n:r.reverse(n)})),c=u[0].conversionData.category,a="text"===c?"photo":"text";return r.every(u,(function(n,t){return n.conversionData.category===(y(t)?c:a)}))?g(u,t,{type:"chessPattern"}):null}},m=function(n){return r(n).map("compRef").uniq().value()},v=function(n){return"x"===n?"y":"x"},y=function(n){return n%2==0};function g(n,t,e){return r.assign(e,{fragments:[{comps:n,distanceToPreviousFragment:-1}],fragmentsEvents:[t]})}function h(n,t){var e=r.findLastIndex(n,(function(n){if(n.coordinate===t.coordinate){if(n.eventType===a&&t.eventType===a)return n.size>t.size;if(n.eventType===s&&t.eventType===s)return n.size<t.size;if(n.eventType===a&&t.eventType===s)return n.compRef===t.compRef;if(n.eventType===s&&t.eventType===a)return n.compRef!==t.compRef}return n.coordinate<t.coordinate}));return n.splice(e+1,0,t),n}function T(n,t){var e=r.transform(n,(function(n,e){var r=e.layout[t]||0,i=Object(o.b)(e,t)||r,u=Object(o.c)(e,t)||0;return h(n,{eventType:a,compRef:e,coordinate:r,size:u}),h(n,{eventType:s,compRef:e,coordinate:i,size:u}),n}),[]);return r.map(e,(function(n){return r.omit(n,"size")}))}function E(n){var t=[],e=[];return r.forEach(n,(function(n){var o=r.last(e);if(n.eventType===a){if(r.isEmpty(t)){var i={events:[n],distanceToPreviousFragment:o?n.coordinate-r.last(o.events).coordinate:-1};e.push(i)}else o.events.push(n);t.push(n)}else r.remove(t,{compRef:n.compRef}),o.events.push(n)})),r.map(e,(function(n){return{comps:m(n.events),distanceToPreviousFragment:n.distanceToPreviousFragment}}))}function O(n,t,e){var o=r.maxBy(n,"distanceToPreviousFragment"),i=r.findIndex(n,o),u=d(n,(function(n){return n<i?0:1})),c=[n[i-1],o],a=r.filter(t[v(e)],(function(n){return r.some(c,(function(t){return r.includes(t.comps,n.compRef)}))})),s={fragmentsEvents:C(t,u),fragments:u},f=_(c,a,e);return r.assign(s,{maxCompsDistance:f})}function _(n,t,e){var i=function(n,t){return r(n).map((function(n,e){return e?r.map(n,(function(n){return r.defaults({closestPoint:n.compRef.layout[t]},n)})):r.map(n,(function(n){return r.defaults({closestPoint:Object(o.b)(n.compRef,t)},n)}))})).map((function(n,t){return r.reduce(n,(function(n,e){var o=r.last(n);return o&&o.eventType!==s?o.compRef===e.compRef?c(n,[e]):((t&&e.closestPoint<o.closestPoint||!t&&e.closestPoint>o.closestPoint)&&n.splice(n.length-1,1,e),n):n.concat(e.eventType===a?[e]:[])}),[])})).value()}(r.partition(t,(function(t){return r.includes(n[0].comps,t.compRef)})),e),u=[0,0],f=[[],[]];for(var l=-1/0;u[0]<i[0].length||u[1]<i[1].length;){var d=u[0]===i[0].length||u[1]===i[1].length?u[0]===i[0].length?1:0:i[0][u[0]].coordinate<=i[1][u[1]].coordinate?0:1,p=i[d][u[d]++];if(p.eventType!==s){f[d].push(p);var m=[r.maxBy(f[0],"closestPoint"),r.minBy(f[1],"closestPoint")],v=r.get(m,[1,"closestPoint"])-r.get(m,[0,"closestPoint"]);!r.isNaN(v)&&v>l&&(l=v)}else r.remove(f[d],{compRef:p.compRef})}return l}function b(n,t){return r.transform(n,(function(n,e){var o=r.findIndex(t,(function(n){return r.includes(n.comps,e.compRef)}));return n[o]=c(n[o]||[],[e]),n}),[])}function C(n,t){var e=b(n.x,t),o=b(n.y,t);return r.map(r.keys(t),(function(n){return r.assign({},{x:e[n],y:o[n]})}))}function D(n,t,e,o){return function(n,t,e){var o=null;return r.forEach(p,(function(r,i){if(!e[i])return!0;var u=r(t.y,n,"y"),c=r(t.x,n,"x");return null===(o=u&&c?null:u||c)})),o}(n,t,e)||function(n,t,e){void 0===e&&(e=!1);var o=r.size(t.x)>1?O(t.x,n,"x"):null,i=r.size(t.y)>1?O(t.y,n,"y"):null;if(o&&i){var u=e?3.27:l,c=f*o.maxCompsDistance>u*i.maxCompsDistance?o:i;return r.pick(c,["fragments","fragmentsEvents"])}return o||i}(n,t,o)}function x(n,t,e,i){if(r.size(t)<2)return t||[];var u=r.mapValues(e,E);if(1===r.size(u.x)&&1===r.size(u.y))return i.detectSemanticGroups?i.useOverlapRules?function(n,t){t=Object(o.h)(n,t);var e="overlayGroup_"+(t=r.sortBy(t,"layout.y"))[0].id;return r.forEach(t,(function(n){return r.set(n,["conversionData","overlayGroupId"],e)})),t}(n,t):function(n,t,e){var o=function(n){return r.some(n,"conversionData.originalLayout")};if(o(t)||r.some(t,(function(n){return o(n)})))return I(t),t;M(t);var i=T(t,"y"),u=T(t,"x"),c=x(n,t,{y:i,x:u},e);return I(c),c}(n,t,i):Object(o.h)(n,t);var c=D(e,u,{mirrorPattern:i.detectSemanticGroups,chessPattern:i.detectSemanticGroups,verticalDivider:!0,singleCompRow:!0},i.enableNewMergeFlow);return 1===r.size(c.fragments)?c.fragments[0].comps:r.flatMap(c.fragments,(function(t,e){return x(n,t.comps,c.fragmentsEvents[e],i)}))}function M(n){r.forEach(n,(function(n){var t=n.layout,e=r.assign(i.objectUtils.cloneDeep(t),{height:.9*t.height,width:.9*t.width});n.layout=e,r.set(n,["conversionData","originalLayout"],t)}))}function I(n,t){void 0===t&&(t=!0),r.forEach(n,(function(n){var t=r.get(n,["conversionData","originalLayout"]);t&&(n.layout=i.objectUtils.cloneDeep(t),delete n.conversionData.originalLayout)})),t&&r.forEach(n,(function(n){return I(n.components,!1)}))}function P(n,t,e){var o=x(n,t,{y:T(t,"y"),x:T(t,"x")},e);n.conversionData.componentsOrder=r.map(o,"id")}o.h},,function(n,t,e){"use strict";e.r(t),e.d(t,"translateComponents",(function(){return r.translateComps})),e.d(t,"getSnugLayout",(function(){return r.getSnugLayout})),e.d(t,"splitToFragments",(function(){return u})),e.d(t,"sortSiblings",(function(){return c})),e.d(t,"getComponentsOrder",(function(){return a}));var r=e(1),o=e(0),i=e(6);function u(n,t){var e=i.a(n,t);return i.b(e)}function c(n){if(o.size(n)<=1)return n;var t=o.map(u(n,"y"),"comps");return o.reduce(t,(function(t,e){if(1===o.size(e))return t.concat(e);var r=o.map(u(e,"x"),"comps"),i=o.flatMap(r,(function(t){return 1===o.size(t)?t:o.sortBy(t,o.findIndex.bind(null,n))}));return t.concat(i)}),[])}function a(n){var t=r.getChildren(n);if(!t)return{};var e=c(t),i=o.set({},n.id,o.map(e,"id")),u=o.map(t,a);return o.assign.apply(o,[i].concat(u))}}])}));
//# sourceMappingURL=mobileLayoutUtils.min.js.map